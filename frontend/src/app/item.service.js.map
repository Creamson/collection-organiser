{"version":3,"file":"item.service.js","sourceRoot":"","sources":["item.service.ts"],"names":[],"mappings":"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","sourcesContent":["import {EventEmitter, Injectable, OnInit} from \"@angular/core\";\r\nimport {Item} from \"./item\";\r\nimport {Category} from \"./category\";\r\nimport {AuthHttp, JwtHelper} from \"angular2-jwt\";\r\nimport {apiPath} from \"../assets/constants\";\r\nimport \"rxjs/add/operator/first\";\r\nimport \"rxjs/add/operator/toPromise\";\r\n\r\n\r\n@Injectable()\r\nexport class ItemService implements OnInit {\r\n\r\n  private id_token: string;\r\n  private decodedJwt: string;\r\n  private url: string = apiPath + 'collections';\r\n  public requestBody = \"\";\r\n  public categoryEvent: EventEmitter<Category[]> = new EventEmitter();\r\n\r\n  constructor(public authHttp: AuthHttp) {\r\n    this.id_token = localStorage.getItem('id_token');\r\n    this.decodedJwt = new JwtHelper().decodeToken(this.id_token);\r\n  }\r\n\r\n  getCategories(): Promise<Category[]> {\r\n    return Promise.resolve(this.authHttp.get(this.url, this.requestBody).toPromise().then(\r\n      response => {\r\n\r\n        let categories: Category[] = [];\r\n        for (let entry of response.json()) {\r\n          categories.push(new Category(entry.name));\r\n        }\r\n        this.categoryEvent.emit(categories);\r\n        return categories;\r\n      },\r\n      error => {\r\n        // TODO stahp infinite logs on backend not running\r\n        console.log(error.text);\r\n        return this.getCategories();\r\n      }\r\n    ));\r\n  }\r\n\r\n  addCategory(category: Category): Promise<Category[]> {\r\n    const requestBody = \"{ \\\"name\\\": \\\"\" + category.name + \"\\\"}\";\r\n    return Promise.resolve(this.authHttp.post(this.url, requestBody).toPromise().then(\r\n      response => {\r\n        return this.getCategories();\r\n      },\r\n      error => {\r\n        console.log(error.text);\r\n        return this.getCategories();\r\n      }\r\n    ));\r\n  }\r\n\r\n  getItemsOfCategory(category: Category): Promise<Item[]> {\r\n    return Promise.resolve(this.authHttp.get(this.url + \"/\" + category.name, this.requestBody).toPromise().then(\r\n      response => {\r\n        let items: Item[] = [];\r\n        if (response.json().hasOwnProperty('items')) {\r\n          const json = response.json().items;\r\n          for (let entry of json) {\r\n            console.log(entry);\r\n            items.push(new Item(entry.name, entry.rating as number, entry.todo as boolean, category));\r\n          }\r\n        }\r\n        return items;\r\n      },\r\n      error => {\r\n        console.log(error.text);\r\n        return this.getItemsOfCategory(category);\r\n      }\r\n    ));\r\n  }\r\n\r\n  updateItem(item: Item): void {\r\n    const requestBody = \"{ \\\"name\\\": \\\"\" + item.name + \"\\\", \\\"todo\\\": \" + item.todo + \", \\\"rating\\\": \" + item.rating + \"}\";\r\n    this.authHttp.put(this.url + \"/\" + item.category.name + \"/\" + item.name, requestBody).subscribe(\r\n      response => {\r\n        console.log(response.text());\r\n      },\r\n      error => console.log(error.text)\r\n    );\r\n  }\r\n\r\n  addItem(item: Item): Promise<Item[]> {\r\n    const requestBody = \"{ \\\"name\\\": \\\"\" + item.name + \"\\\", \\\"todo\\\": \" + item.todo + \", \\\"rating\\\": \" + item.rating + \"}\";\r\n    return Promise.resolve(this.authHttp.post(this.url + \"/\" + item.category.name, requestBody).toPromise().then(\r\n      response => {\r\n        console.log(response.text());\r\n        return this.getItemsOfCategory(item.category);\r\n      },\r\n      error => {\r\n        console.log(error.text);\r\n        return this.getItemsOfCategory(item.category);\r\n      }\r\n    ));\r\n  }\r\n\r\n  deleteItem(item: Item): Promise<Item[]> {\r\n    const requestBody = \"{ \\\"name\\\": \\\"\" + item.name + \"\\\", \\\"todo\\\": \" + item.todo + \", \\\"rating\\\": \" + item.rating + \"}\";\r\n    console.log(requestBody);\r\n    return Promise.resolve(this.authHttp.delete(this.url + \"/\" + item.category.name + \"/\" + item.name, requestBody).toPromise().then(\r\n      response => {\r\n        return this.getItemsOfCategory(item.category);\r\n      },\r\n      error => {\r\n        console.log(error.text);\r\n        return this.getItemsOfCategory(item.category);\r\n      }\r\n    ));\r\n  }\r\n\r\n  deleteCategory(category: Category): Promise<Category[]> {\r\n    const requestBody = \"{ \\\"name\\\": \\\"\" + category.name + \"\\ }\";\r\n    console.log(requestBody);\r\n    return Promise.resolve(this.authHttp.delete(this.url + \"/\" + category.name, requestBody).toPromise().then(\r\n      response => {\r\n        console.log(response.text());\r\n        return this.getCategories();\r\n      },\r\n      error => {\r\n        console.log(error.text);\r\n        return this.getCategories();\r\n      }\r\n    ));\r\n  }\r\n\r\n  getCategory(name: string): Promise<Category> {\r\n    return this.getCategories()\r\n      .then(categories => categories.find(\r\n        category => category.name === name,\r\n        error => console.log(error.text)\r\n      ));\r\n  }\r\n\r\n  ngOnInit(): void {\r\n  }\r\n}\r\n"]}