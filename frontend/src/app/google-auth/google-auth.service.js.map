{"version":3,"file":"google-auth.service.js","sourceRoot":"","sources":["google-auth.service.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,sCAAyC;AACzC,wDAAmD;AACnD,0CAAuC;AAGvC,IAAM,GAAG,GAAG,gEAAgE,CAAC;AAG7E,IAAa,iBAAiB;IAmD5B,2BAAoB,MAAc;QAAd,WAAM,GAAN,MAAM,CAAQ;QAChC,IAAI,CAAC,QAAQ,GAAG,uBAAS,CAAC;QAE1B,IAAI,CAAC,SAAS,EAAE,CAAC;IACnB,CAAC;IA/CM,qCAAS,GAAhB;QAAA,iBAcC;QAbC,IAAM,IAAI,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,cAAc,GAAG,IAAI,OAAO,CAAC,UAAC,OAAO;YACxC,MAAM,CAAC,kBAAkB,CAAC,GAAG;gBAC3B,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;oBACjB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;wBAC3B,SAAS,EAAE,IAAI,CAAC,QAAQ;wBACxB,YAAY,EAAE,oBAAoB;qBACnC,CAAC,CAAC;oBACH,OAAO,EAAE,CAAC;gBACZ,CAAC,CAAC,CAAC;YACL,CAAC,CAAC;YACF,KAAI,CAAC,cAAc,EAAE,CAAC;QACxB,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,wCAAY,GAAnB,UAAoB,OAAO;QACzB,IAAM,IAAI,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAE;YACxB,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,OAAO,EAAE,EAAE,EACvC,UAAU,UAAU;gBAClB,gDAAgD;gBAChD,IAAM,QAAQ,GAAW,UAAU,CAAC,eAAe,EAAE,CAAC,QAAQ,CAAC;gBAE/D,YAAY,CAAC,OAAO,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;gBAC3C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YACjC,CAAC,EAAE,UAAU,KAAK;gBAChB,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC;YACnD,CAAC,CAAC,CAAC;QACP,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,yCAAa,GAApB;QACE,IAAM,IAAI,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC;YACvB,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;gBACxB,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;YAClC,CAAC,CAAC,CAAC;YACH,YAAY,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;YACpC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;IACL,CAAC;IAQO,0CAAc,GAAtB;QACE,IAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAC9C,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACf,IAAI,CAAC,IAAI,GAAG,iBAAiB,CAAC;QAC9B,QAAQ,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;IAE7D,CAAC;IAGH,wBAAC;AAAD,CAAC,AAlED,IAkEC;AAlEY,iBAAiB;IAD7B,iBAAU,EAAE;qCAoDiB,eAAM;GAnDvB,iBAAiB,CAkE7B;AAlEY,8CAAiB","sourcesContent":["import {Injectable} from '@angular/core';\r\nimport {CLIENT_ID} from '../../assets/client-info';\r\nimport {Router} from '@angular/router';\r\n\r\ndeclare const gapi: any;\r\nconst url = 'https://apis.google.com/js/platform.js?onload=__onGoogleLoaded';\r\n\r\n@Injectable()\r\nexport class GoogleAuthService {\r\n\r\n  private clientId: string;\r\n\r\n  public auth2: any;\r\n\r\n  private loadAPIPromise: Promise<any>;\r\n\r\n  public initAuth2() {\r\n    const that = this;\r\n    this.loadAPIPromise = new Promise((resolve) => {\r\n      window['__onGoogleLoaded'] = () => {\r\n        gapi.load('auth2', () => {\r\n          that.auth2 = gapi.auth2.init({\r\n            client_id: that.clientId,\r\n            cookiepolicy: 'single_host_origin'\r\n          });\r\n          resolve();\r\n        });\r\n      };\r\n      this.loadGapiScript();\r\n    });\r\n  }\r\n\r\n  public attachSignin(element) {\r\n    const that = this;\r\n    this.loadAPIPromise.then( () => {\r\n      that.auth2.attachClickHandler(element, {},\r\n        function (googleUser) {\r\n          // const profile = googleUser.getBasicProfile();\r\n          const id_token: string = googleUser.getAuthResponse().id_token;\r\n\r\n          localStorage.setItem('id_token', id_token);\r\n          that.router.navigate(['home']);\r\n        }, function (error) {\r\n          console.log(JSON.stringify(error, undefined, 2));\r\n        });\r\n    });\r\n  }\r\n\r\n  public googleSignOut() {\r\n    const that = this;\r\n    this.loadAPIPromise.then(() => {\r\n      that.auth2.signOut().then(function () {\r\n        console.log('User signed out.');\r\n      });\r\n      localStorage.removeItem('id_token');\r\n      that.router.navigate(['']);\r\n    });\r\n  }\r\n\r\n  constructor(private router: Router) {\r\n    this.clientId = CLIENT_ID;\r\n\r\n    this.initAuth2();\r\n  }\r\n\r\n  private loadGapiScript() {\r\n    const node = document.createElement('script');\r\n    node.src = url;\r\n    node.type = 'text/javascript';\r\n    document.getElementsByTagName('head')[0].appendChild(node);\r\n\r\n  }\r\n\r\n\r\n}\r\n"]}