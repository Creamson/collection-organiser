{"version":3,"file":"google-auth.service.js","sourceRoot":"","sources":["google-auth.service.ts"],"names":[],"mappings":"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","sourcesContent":["import {Injectable} from '@angular/core';\nimport {CLIENT_ID} from '../../assets/client-info';\nimport {Router} from '@angular/router';\n\ndeclare const gapi: any;\nconst url = 'https://apis.google.com/js/platform.js?onload=__onGoogleLoaded';\n\n@Injectable()\nexport class GoogleAuthService {\n\n  private clientId: string;\n\n  public auth2: any;\n\n  private loadAPI: Promise<any>;\n\n  public init() {\n    const that = this;\n    this.loadAPI.then(() => {\n      gapi.load('auth2', () => {\n        that.auth2 = gapi.auth2.init({\n          client_id: that.clientId,\n          cookiepolicy: 'single_host_origin'\n        });\n      });\n    });\n  }\n\n  private waitTillAuthInitialized(funToExecute, retries = 10) {\n    const that = this;\n    if (this.auth2 == null) {\n      setTimeout(function () {\n        if (retries > 0) {\n          that.waitTillAuthInitialized(funToExecute, retries - 1);\n        } else {\n          console.log('Failed to execute function - initialization took too long.');\n        }\n      }, 100);\n    } else {\n      funToExecute();\n    }\n  }\n\n  public attachSignin(element) {\n    const that = this;\n    const attachFun = function () {\n      that.auth2.attachClickHandler(element, {},\n        function (googleUser) {\n\n          // const profile = googleUser.getBasicProfile();\n          const id_token: string = googleUser.getAuthResponse().id_token;\n\n          localStorage.setItem('id_token', id_token);\n          that.router.navigate(['home']);\n        }, function (error) {\n          console.log(JSON.stringify(error, undefined, 2));\n        });\n    };\n    this.waitTillAuthInitialized(attachFun);\n  }\n\n  public googleSignOut() {\n    const that = this;\n    const signoutFun = function () {\n      that.auth2.signOut().then(function () {\n        console.log('User signed out.');\n      });\n      localStorage.removeItem('id_token');\n      that.router.navigate(['']);\n    };\n    this.waitTillAuthInitialized(signoutFun);\n  }\n\n  constructor(private router: Router) {\n    this.clientId = CLIENT_ID;\n\n    this.loadAPI = new Promise((resolve) => {\n      window['__onGoogleLoaded'] = (ev) => {\n        console.log('gapi loaded');\n        resolve(gapi);\n      };\n      this.loadScript();\n    });\n    this.init();\n  }\n\n  private loadScript() {\n    console.log('loading..');\n    const node = document.createElement('script');\n    node.src = url;\n    node.type = 'text/javascript';\n    document.getElementsByTagName('head')[0].appendChild(node);\n\n  }\n\n\n}\n"]}