{"version":3,"file":"google-auth.service.js","sourceRoot":"","sources":["google-auth.service.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,sCAAyC;AACzC,wDAAmD;AACnD,0CAAuC;AAKvC,IAAa,iBAAiB;IA6D5B,2BAAoB,MAAc;QAAd,WAAM,GAAN,MAAM,CAAQ;QAChC,IAAI,CAAC,QAAQ,GAAG,uBAAS,CAAC;QAC1B,IAAI,CAAC,IAAI,EAAE,CAAC;IACd,CAAC;IA1DM,gCAAI,GAAX;QACE,IAAM,IAAI,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;YACjB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;gBAC3B,SAAS,EAAE,IAAI,CAAC,QAAQ;gBACxB,YAAY,EAAE,oBAAoB;aACnC,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,mDAAuB,GAA/B,UAAgC,YAAY,EAAE,OAAY;QAAZ,wBAAA,EAAA,YAAY;QACxD,IAAM,IAAI,GAAG,IAAI,CAAC;QAClB,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,IAAI,IAAI,CAAC,CAAC,CAAC;YACvB,UAAU,CAAC;gBACT,EAAE,CAAC,CAAC,OAAO,GAAG,CAAC,CAAC,CAAC,CAAC;oBAChB,IAAI,CAAC,uBAAuB,CAAC,YAAY,EAAE,OAAO,GAAG,CAAC,CAAC,CAAC;gBAC1D,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACN,OAAO,CAAC,GAAG,CAAC,4DAA4D,CAAC,CAAC;gBAC5E,CAAC;YACH,CAAC,EAAE,GAAG,CAAC,CAAC;QACV,CAAC;QAAC,IAAI,CAAC,CAAC;YACN,YAAY,EAAE,CAAC;QACjB,CAAC;IACH,CAAC;IAEM,wCAAY,GAAnB,UAAoB,OAAO;QACzB,IAAM,IAAI,GAAG,IAAI,CAAC;QAClB,IAAM,SAAS,GAAG;YAChB,IAAI,CAAC,KAAK,CAAC,kBAAkB,CAAC,OAAO,EAAE,EAAE,EACvC,UAAU,UAAU;gBAElB,gDAAgD;gBAChD,IAAM,QAAQ,GAAW,UAAU,CAAC,eAAe,EAAE,CAAC,QAAQ,CAAC;gBAE/D,YAAY,CAAC,OAAO,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;gBAC3C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC;YACjC,CAAC,EAAE,UAAU,KAAK;gBAChB,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC;YACnD,CAAC,CAAC,CAAC;QACP,CAAC,CAAC;QACF,IAAI,CAAC,uBAAuB,CAAC,SAAS,CAAC,CAAC;IAC1C,CAAC;IAEM,yCAAa,GAApB;QACE,IAAM,IAAI,GAAG,IAAI,CAAC;QAClB,IAAM,UAAU,GAAG;YACjB,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;gBACxB,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;YAClC,CAAC,CAAC,CAAC;YACH,YAAY,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;YACpC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC7B,CAAC,CAAC;QACF,IAAI,CAAC,uBAAuB,CAAC,UAAU,CAAC,CAAC;IAC3C,CAAC;IAQH,wBAAC;AAAD,CAAC,AAnED,IAmEC;AAnEY,iBAAiB;IAD7B,iBAAU,EAAE;qCA8DiB,eAAM;GA7DvB,iBAAiB,CAmE7B;AAnEY,8CAAiB","sourcesContent":["import {Injectable} from '@angular/core';\r\nimport {CLIENT_ID} from '../../assets/client-info';\r\nimport {Router} from '@angular/router';\r\n\r\ndeclare const gapi: any;\r\n\r\n@Injectable()\r\nexport class GoogleAuthService {\r\n\r\n  private clientId: string;\r\n\r\n  public auth2: any;\r\n\r\n  public init() {\r\n    const that = this;\r\n    gapi.load('auth2', function () {\r\n      that.auth2 = gapi.auth2.init({\r\n        client_id: that.clientId,\r\n        cookiepolicy: 'single_host_origin'\r\n      });\r\n    });\r\n  }\r\n\r\n  private waitTillAuthInitialized(funToExecute, retries = 10) {\r\n    const that = this;\r\n    if (this.auth2 == null) {\r\n      setTimeout(function () {\r\n        if (retries > 0) {\r\n          that.waitTillAuthInitialized(funToExecute, retries - 1);\r\n        } else {\r\n          console.log('Failed to execute function - initialization took too long.');\r\n        }\r\n      }, 100);\r\n    } else {\r\n      funToExecute();\r\n    }\r\n  }\r\n\r\n  public attachSignin(element) {\r\n    const that = this;\r\n    const attachFun = function () {\r\n      that.auth2.attachClickHandler(element, {},\r\n        function (googleUser) {\r\n\r\n          // const profile = googleUser.getBasicProfile();\r\n          const id_token: string = googleUser.getAuthResponse().id_token;\r\n\r\n          localStorage.setItem('id_token', id_token);\r\n          that.router.navigate(['home']);\r\n        }, function (error) {\r\n          console.log(JSON.stringify(error, undefined, 2));\r\n        });\r\n    };\r\n    this.waitTillAuthInitialized(attachFun);\r\n  }\r\n\r\n  public googleSignOut() {\r\n    const that = this;\r\n    const signoutFun = function() {\r\n      that.auth2.signOut().then(function () {\r\n        console.log('User signed out.');\r\n      });\r\n      localStorage.removeItem('id_token');\r\n      that.router.navigate(['']);\r\n    };\r\n    this.waitTillAuthInitialized(signoutFun);\r\n  }\r\n\r\n  constructor(private router: Router) {\r\n    this.clientId = CLIENT_ID;\r\n    this.init();\r\n  }\r\n\r\n\r\n}\r\n"]}