{"version":3,"file":"google-auth.service.js","sourceRoot":"","sources":["google-auth.service.ts"],"names":[],"mappings":";;;;;;;;;;;AAAA,sCAAyC;AACzC,wDAAmD;AACnD,0CAAuC;AAGvC,IAAM,GAAG,GAAG,gEAAgE,CAAC;AAG7E,IAAa,iBAAiB;IA4D5B,2BAAoB,MAAc;QAAd,WAAM,GAAN,MAAM,CAAQ;QAChC,IAAI,CAAC,QAAQ,GAAG,uBAAS,CAAC;QAE1B,IAAI,CAAC,SAAS,EAAE,CAAC;IACnB,CAAC;IAxDM,qCAAS,GAAhB;QAAA,iBAcC;QAbC,IAAM,IAAI,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,cAAc,GAAG,IAAI,OAAO,CAAC,UAAC,OAAO;YACxC,MAAM,CAAC,kBAAkB,CAAC,GAAG;gBAC3B,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE;oBACjB,IAAI,CAAC,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC;wBAC3B,SAAS,EAAE,IAAI,CAAC,QAAQ;wBACxB,YAAY,EAAE,oBAAoB;qBACnC,CAAC,CAAC;oBACH,OAAO,EAAE,CAAC;gBACZ,CAAC,CAAC,CAAC;YACL,CAAC,CAAC;YACF,KAAI,CAAC,cAAc,EAAE,CAAC;QACxB,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,wCAAY,GAAnB;QACE,IAAM,IAAI,GAAG,IAAI,CAAC;QAElB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAE;YACxB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,WAAW,EAAE;gBAC/B,OAAO,EAAE,eAAe;gBACxB,OAAO,EAAE,GAAG;gBACZ,QAAQ,EAAE,EAAE;gBACZ,WAAW,EAAE,IAAI;gBACjB,OAAO,EAAE,MAAM;gBACf,WAAW,EAAE,UAAS,UAAU;oBAC9B,IAAM,QAAQ,GAAW,UAAU,CAAC,eAAe,EAAE,CAAC,QAAQ,CAAC;oBAE/D,YAAY,CAAC,OAAO,CAAC,UAAU,EAAE,QAAQ,CAAC,CAAC;oBAC3C,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC;wBAClC,QAAQ,CAAC,MAAM,EAAE,CAAC;oBACpB,CAAC,CAAC,CAAC;gBACL,CAAC;gBACD,WAAW,EAAE,UAAU,KAAK;oBAC1B,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,SAAS,CAAC,KAAK,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC;gBACnD,CAAC;aACF,CAAC,CAAC;QACL,CAAC,CAAC,CAAC;IACL,CAAC;IAEM,yCAAa,GAApB;QACE,IAAM,IAAI,GAAG,IAAI,CAAC;QAClB,IAAI,CAAC,cAAc,CAAC,IAAI,CAAC;YACvB,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,CAAC,IAAI,CAAC;gBACxB,OAAO,CAAC,GAAG,CAAC,kBAAkB,CAAC,CAAC;YAClC,CAAC,CAAC,CAAC;YACH,YAAY,CAAC,UAAU,CAAC,UAAU,CAAC,CAAC;YACpC,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;QAC7B,CAAC,CAAC,CAAC;IACL,CAAC;IAQO,0CAAc,GAAtB;QACE,IAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAC9C,IAAI,CAAC,GAAG,GAAG,GAAG,CAAC;QACf,IAAI,CAAC,IAAI,GAAG,iBAAiB,CAAC;QAC9B,QAAQ,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC;IAC7D,CAAC;IAGH,wBAAC;AAAD,CAAC,AA1ED,IA0EC;AA1EY,iBAAiB;IAD7B,iBAAU,EAAE;qCA6DiB,eAAM;GA5DvB,iBAAiB,CA0E7B;AA1EY,8CAAiB","sourcesContent":["import {Injectable} from '@angular/core';\nimport {CLIENT_ID} from '../../assets/client-info';\nimport {Router} from '@angular/router';\n\ndeclare const gapi: any;\nconst url = 'https://apis.google.com/js/platform.js?onload=__onGoogleLoaded';\n\n@Injectable()\nexport class GoogleAuthService {\n\n  private clientId: string;\n\n  public auth2: any;\n\n  private loadAPIPromise: Promise<any>;\n\n  public initAuth2() {\n    const that = this;\n    this.loadAPIPromise = new Promise((resolve) => {\n      window['__onGoogleLoaded'] = () => {\n        gapi.load('auth2', () => {\n          that.auth2 = gapi.auth2.init({\n            client_id: that.clientId,\n            cookiepolicy: 'single_host_origin'\n          });\n          resolve();\n        });\n      };\n      this.loadGapiScript();\n    });\n  }\n\n  public attachSignin() {\n    const that = this;\n\n    this.loadAPIPromise.then( () => {\n      gapi.signin2.render('ggl-btn-2', {\n        'scope': 'profile email',\n        'width': 200,\n        'height': 40,\n        'longtitle': true,\n        'theme': 'dark',\n        'onsuccess': function(googleUser){\n          const id_token: string = googleUser.getAuthResponse().id_token;\n\n          localStorage.setItem('id_token', id_token);\n          that.router.navigate(['home']).then(function(){\n            location.reload();\n          });\n        },\n        'onfailure': function (error) {\n          console.log(JSON.stringify(error, undefined, 2));\n        }\n      });\n    });\n  }\n\n  public googleSignOut() {\n    const that = this;\n    this.loadAPIPromise.then(() => {\n      that.auth2.signOut().then(function () {\n        console.log('User signed out.');\n      });\n      localStorage.removeItem('id_token');\n      that.router.navigate(['']);\n    });\n  }\n\n  constructor(private router: Router) {\n    this.clientId = CLIENT_ID;\n\n    this.initAuth2();\n  }\n\n  private loadGapiScript() {\n    const node = document.createElement('script');\n    node.src = url;\n    node.type = 'text/javascript';\n    document.getElementsByTagName('head')[0].appendChild(node);\n  }\n\n\n}\n"]}